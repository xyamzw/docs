import{_ as t,a as h,b as r,c as p,d as k}from"./bt_reverse_proxy-DAfzcnRs.js";import{_ as d,j as o,f as i,m as g,e as a,a as n,w as l,l as c,o as m}from"./app-Bl4GcpgC.js";const u={};function A(y,s){const e=c("RouteLink");return m(),o("div",null,[s[5]||(s[5]=i("h1",{id:"反向代理",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#反向代理"},[i("span",null,"反向代理")])],-1)),i("p",null,[s[1]||(s[1]=a("程序默认监听 5244 端口。如有修改，请一并修改下列配置中的端口号。如果你使用反向代理，建议你设置")),n(e,{to:"/zh/config/configuration.html#site_url"},{default:l(()=>s[0]||(s[0]=[a("site_url")])),_:1,__:[0]}),s[2]||(s[2]=a("，以帮助alist更好的工作。"))]),i("blockquote",null,[i("p",null,[s[4]||(s[4]=a("如果你想使用子目录，参考")),n(e,{to:"/zh/faq/howto.html#%E5%A6%82%E4%BD%95%E5%AF%B9%E5%AD%90%E7%9B%AE%E5%BD%95%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"},{default:l(()=>s[3]||(s[3]=[a("这里")])),_:1,__:[3]})])]),s[6]||(s[6]=g(`<div class="hint-container tip"><p class="hint-container-title">反向代理非标准端口或启用https后丢失https或端口号/无法播放视频?</p><p>你需要通过正确的Host头,请参考 <a href="https://github.com/alist-org/alist/issues/726" target="_blank" rel="noopener noreferrer">#726</a> <a href="https://github.com/alist-org/alist/issues/1159" target="_blank" rel="noopener noreferrer">#1159</a> <a href="https://github.com/alist-org/alist/issues/2429" target="_blank" rel="noopener noreferrer">#2429</a> <a href="https://github.com/alist-org/alist/issues/3644" target="_blank" rel="noopener noreferrer">#3644</a> <a href="https://github.com/alist-org/alist/issues/4181" target="_blank" rel="noopener noreferrer">#4181</a> <a href="https://github.com/alist-org/alist/issues/4719" target="_blank" rel="noopener noreferrer">#4719</a></p></div><h2 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx"><span><strong>nginx</strong></span></a></h2><p>在网站配置文件的 server 字段中添加</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> X-Forwarded-For</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $proxy_add_x_forwarded_for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> X-Forwarded-Proto</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $scheme</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Range</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $http_range</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> If-Range</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $http_if_range</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_redirect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  proxy_pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://127.0.0.1:5244</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # the max size of file to upload</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  client_max_body_size</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 20000m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果需要使用HTTP/3，需要将对应<code>HOST</code>行修改为：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$server_port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样修改后的配置同时也可以兼容HTTP/2及更低版本的请求。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>如果使用宝塔面板，请务必删除以下默认配置</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ^/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\.user.ini</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\.htaccess</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\.git</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\.svn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\.project</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LICENSE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">README.md</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\*\\.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gif</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jpg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jpeg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">png</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bmp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">swf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)$</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\*\\.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">js</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">css</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">?</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>并在<code>/www/server/nginx/conf/proxy.conf</code>中或对应网站配置文件中设置禁用Nginx缓存，否则默认配置下访问较大文件时Nginx会先尝试将远程文件缓存至本机，导致播放失败</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">proxy_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cache_one</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 删除这一行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">proxy_max_temp_file_size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#加上这一行</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="apache" tabindex="-1"><a class="header-anchor" href="#apache"><span><strong>Apache</strong></span></a></h2><p>在 VirtualHost 字段下添加配置项 ProxyPass，如：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">VirtualHost</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> *:80&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ServerName myapp.example.com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ServerAdmin webmaster@example.com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DocumentRoot /www/myapp/public</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    AllowEncodedSlashes NoDecode</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ProxyPreserveHost On</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ProxyPass &quot;/&quot; &quot;http://127.0.0.1:5244/&quot; nocanon</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ProxyPassReverse &quot;/&quot; &quot;http://127.0.0.1:5244/&quot; nocanon</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">VirtualHost</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="caddy" tabindex="-1"><a class="header-anchor" href="#caddy"><span><strong>Caddy</strong></span></a></h2><p>在 Caddyfile 文件下添加 reverse_proxy，如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:80 {</span></span>
<span class="line"><span>  reverse_proxy 127.0.0.1:5244</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果部署在 443 端口正常使用的服务器上且使用域名进行访问，建议使用这种配置让 Caddy 自动申请证书：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>example.com {</span></span>
<span class="line"><span>  reverse_proxy 127.0.0.1:5244</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>将 \`example.com\` 替换为你自己解析后的域名。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="宝塔设置反向代理示范" tabindex="-1"><a class="header-anchor" href="#宝塔设置反向代理示范"><span><strong>宝塔设置反向代理示范</strong></span></a></h2><h4 id="_1-登录宝塔面板-添加站点" tabindex="-1"><a class="header-anchor" href="#_1-登录宝塔面板-添加站点"><span>1.登录宝塔面板，添加站点；</span></a></h4><p><img src="`+t+'" alt="bt_new_website" loading="lazy"></p><h4 id="_2-修改站点设置" tabindex="-1"><a class="header-anchor" href="#_2-修改站点设置"><span>2.修改站点设置；</span></a></h4><p><img src="'+h+'" alt="bt_new_website_01" loading="lazy"></p><h4 id="_3-删除面板默认代码" tabindex="-1"><a class="header-anchor" href="#_3-删除面板默认代码"><span>3.删除面板默认代码；</span></a></h4><p><img src="'+r+'" alt="bt_delete_default_config_01" loading="lazy"></p><p><img src="'+p+'" alt="bt_delete_default_config_02" loading="lazy"></p><h4 id="_4-添加反向代理" tabindex="-1"><a class="header-anchor" href="#_4-添加反向代理"><span>4.添加反向代理；</span></a></h4><p><img src="'+k+'" alt="bt_reverse_proxy" loading="lazy"></p><blockquote><p>如需申请<code>SSL</code>证书，可先在<code>SSL</code>选项中申请证书，然后在设置反向代理。或者设置反向代理之后，关闭反向代理功能，申请<code>SSL</code>证书后再次开启代理。</p></blockquote>',27))])}const B=d(u,[["render",A]]),v=JSON.parse('{"path":"/zh/guide/install/reverse-proxy.html","title":"反向代理","lang":"zh-CN","frontmatter":{"icon":"iconfont icon-page","order":11,"category":["Guide"],"tag":["Install","Guide"],"sticky":true,"star":true},"headers":[{"level":2,"title":"nginx","slug":"nginx","link":"#nginx","children":[]},{"level":2,"title":"Apache","slug":"apache","link":"#apache","children":[]},{"level":2,"title":"Caddy","slug":"caddy","link":"#caddy","children":[]},{"level":2,"title":"宝塔设置反向代理示范","slug":"宝塔设置反向代理示范","link":"#宝塔设置反向代理示范","children":[{"level":4,"title":"1.登录宝塔面板，添加站点；","slug":"_1-登录宝塔面板-添加站点","link":"#_1-登录宝塔面板-添加站点","children":[]},{"level":4,"title":"2.修改站点设置；","slug":"_2-修改站点设置","link":"#_2-修改站点设置","children":[]},{"level":4,"title":"3.删除面板默认代码；","slug":"_3-删除面板默认代码","link":"#_3-删除面板默认代码","children":[]},{"level":4,"title":"4.添加反向代理；","slug":"_4-添加反向代理","link":"#_4-添加反向代理","children":[]}]}],"git":{"createdTime":1662556125000,"updatedTime":1739680079000,"contributors":[{"name":"Noah Hsu","username":"Noah Hsu","email":"i@nn.ci","commits":4,"url":"https://github.com/Noah Hsu"},{"name":"flower_elf","username":"flower_elf","email":"47104993+flower-elf@users.noreply.github.com","commits":1,"url":"https://github.com/flower_elf"},{"name":"Chi_Tang","username":"Chi_Tang","email":"chitang@duck.com","commits":1,"url":"https://github.com/Chi_Tang"},{"name":"安稳","username":"安稳","email":"56105412+anwen-anyi@users.noreply.github.com","commits":4,"url":"https://github.com/安稳"},{"name":"Andy Hsu","username":"Andy Hsu","email":"i@nn.ci","commits":4,"url":"https://github.com/Andy Hsu"},{"name":"troray","username":"troray","email":"binghe27@gmail.com","commits":1,"url":"https://github.com/troray"},{"name":"hiqz","username":"hiqz","email":"cncpu@qq.com","commits":1,"url":"https://github.com/hiqz"},{"name":"Ivor Deng","username":"Ivor Deng","email":"84375706+DLYSY@users.noreply.github.com","commits":1,"url":"https://github.com/Ivor Deng"},{"name":"孔维锐","username":"孔维锐","email":"weiruik@outlook.com","commits":1,"url":"https://github.com/孔维锐"},{"name":"资深小白程序猿","username":"资深小白程序猿","email":"zsxb-2468@qq.com","commits":1,"url":"https://github.com/资深小白程序猿"},{"name":"安稳","username":"安稳","email":"anwen_anyi@foxmail.com","commits":1,"url":"https://github.com/安稳"},{"name":"Andy Hsu","username":"Andy Hsu","email":"xhofe@qq.com","commits":1,"url":"https://github.com/Andy Hsu"}]},"readingTime":{"minutes":2.21,"words":663},"filePathRelative":"zh/guide/install/reverse-proxy.md","localizedDate":"2022年9月7日"}');export{B as comp,v as data};
